function httpPost4Pages(e,t){var n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onload=function(){numPages=document.getElementsByName("SelectPage")[0].length-1,t()},n.send()}function httpPost4Mtus(e,t,n){var a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=function(){var e=document.createElement("div");e.innerHTML=this.responseText;for(var t=e.getElementsByTagName("input"),a=1;a<t.length-1;a++)arrMtus.push(parseInt(t[a].value));itera++,itera==numPages&&n()},a.send("Page="+t)}function httpPost_UM(e,t){var n=new XMLHttpRequest;n.open("POST","https://pso-"+emea+"/dba/async_list.cfm",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onload=function(){var n=getToProcess(this.responseText);""!=n[0]&&""!=n[1]?state.push({mtu:e,inNew:n[1].split(",").length,inProcess:n[0].split(",").length,toProcess:n[0].split(",")}):""!=n[0]?state.push({mtu:e,inNew:0,inProcess:n[0].split(",").length,toProcess:n[0].split(",")}):""!=n[1]&&state.push({mtu:e,inNew:n[1].split(",").length,inProcess:0}),itera2++,itera2==arrMtus.length&&t()},n.send("chkAccountId="+e)}function getToProcess(e){var t=document.createElement("div");return t.innerHTML=e,[t.getElementsByTagName("form")[0].children[1].value,t.getElementsByTagName("form")[0].children[2].value]}function getPagesAndMtus(e){httpPost4Pages("https://pso-"+emea+"/dba/async_mngt.cfm",function(){for(var t=1;numPages>=t;t++)httpPost4Mtus("https://pso-"+emea+"/dba/async_mngt.cfm",t,function(){console.log("completo:"+arrMtus.length),arrMtus.sort(function(e,t){return e-t}),e()})})}function insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function createTable(e){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href="https://dl.dropboxusercontent.com/u/4777/async/table.css",document.head.appendChild(t);var n=document.createElement("div");n.className="CSSTableGenerator";var a=document.getElementsByTagName("tbody")[3],s=document.createElement("table");s.id=e?"tableTots":"tableRes",s.border=3,insertAfter(n,a);var o=document.createElement("th"),d=document.createElement("th"),r=document.createElement("th");if(o.className="head",d.className="head",r.className="head",e)var l=document.createTextNode("Total of MTUs"),c=document.createTextNode("Total of New"),i=document.createTextNode("Total of In Process");else var l=document.createTextNode("MTU"),c=document.createTextNode("New"),i=document.createTextNode("In Process");o.appendChild(l),d.appendChild(c),r.appendChild(i),s.appendChild(o),s.appendChild(d),s.appendChild(r),document.body.appendChild(n),n.appendChild(s),e?(document.getElementsByClassName("head")[3].style.padding="10px",document.getElementsByClassName("head")[4].style.padding="10px",document.getElementsByClassName("head")[5].style.padding="10px"):(document.getElementsByClassName("head")[0].style.padding="10px",document.getElementsByClassName("head")[1].style.padding="10px",document.getElementsByClassName("head")[2].style.padding="10px",document.getElementsByTagName("table")[4].style["float"]="left")}function insertRow(e,t,n,a){var s=document.getElementById(e),o=document.createElement("tr"),d=document.createTextNode(t),r=document.createTextNode(n),l=document.createTextNode(a),c=document.createElement("td"),i=document.createElement("td"),m=document.createElement("td");c.appendChild(d),i.appendChild(r),m.appendChild(l),o.appendChild(c),o.appendChild(i),o.appendChild(m),s.appendChild(o),o.className="row",count++}function getState(){emea=document.getElementById("emea").value,getPagesAndMtus(function(){if(console.log("lenght here (getState):"+arrMtus.length),null==document.getElementById("tableRes"))createTable(!1),createTable(!0);else for(var e=document.getElementById("tableRes").getElementsByTagName("tr");e.length>0;)e[0].remove();for(var t=0,n=0,a=0;a<arrMtus.length;a++)httpPost_UM(arrMtus[a],function(){for(var e=0;e<state.length;e++)t+=state[e].inNew,n+=state[e].inProcess,state[e].inProcess>0&&mtusInProcess.push(state[e].mtu),insertRow("tableRes",state[e].mtu,state[e].inNew,state[e].inProcess);insertRow("tableTots",state.length,t,n),node2.disabled=!1,node.disabled=!0,node.innerHTML="Done!",node2.hidden=!1,node2.innerHTML="Process all In Process"})})}function httpProcessInProcess(e,t){for(var n=0;n<state.length;n++)if(state[n].toProcess){var a=new XMLHttpRequest;a.open("POST","https://pso-"+emea+"/dba/async_list.cfm",!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=function(){console.log("...processed"),itera3++,itera3==e&&t()},a.send("chkAccountId="+state[n].mtu+"&nProcessLimit=-1&bInProcessSubmit=Process+%27InProcess%27&lNew=&lInProcess="+state[n].toProcess.toString().replace(/,/g,"%2C"))}}function reload(){numPages=0,arrMtus=[],state=[],itera=0,itera2=0,itera3=0,count=0,mtusInProcess=[]}function processAll(){var e=mtusInProcess.length;0==e?(alert('Nothing to Process, did you run "Get Status"?'),node.disabled=!1,node.innerHTML="Get Status",reload()):(console.log("Request should be made here...."),httpProcessInProcess(e,function(){node2.innerHTML="COMPLETED!",node2.disabled=!0,reload(),node.disabled=!1,node.innerHTML="Get Status"}))}var numPages=0,arrMtus=[],form=document.createElement("span"),input1=document.createElement("INPUT"),br1=document.createElement("br");input1.setAttribute("type","text"),input1.setAttribute("id","emea"),input1.setAttribute("value","emea3"),form.appendChild(input1),form.appendChild(br1),document.getElementsByName("pagenavigation")[0].parentNode.appendChild(form);var node=document.createElement("button");node.innerHTML="Get Status",node.addEventListener("click",function(){getState(),node.disabled=!0,node2.disabled=!0,node.innerHTML="wait...."}),document.getElementsByName("pagenavigation")[0].parentNode.appendChild(node);var node2=document.createElement("button");node2.innerHTML="Process all In Process",node2.hidden=!0,node2.addEventListener("click",function(){processAll(),node2.disabled=!0}),document.getElementsByName("pagenavigation")[0].parentNode.appendChild(node2);var emea="",itera=0,state=[],itera2=0,count=0,mtusInProcess=[],itera3=0;